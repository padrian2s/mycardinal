<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NStarX Quick Links Portal</title>

    <!-- TuiCss CSS (loaded conditionally) -->
    <link id="tuicss-stylesheet" rel="stylesheet" href="https://unpkg.com/tuicss@2.1.1/dist/tuicss.min.css" disabled>

    <!-- Common CSS -->
    <link rel="stylesheet" href="assets/css/common.css">

    <style id="modern-styles">
        /* Page-specific background color */
        body {
            background-color: #1a0f2e;
        }

        /* Isogrid background - very subtle */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('isogrid-large.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.03;
            pointer-events: none;
            z-index: -4;
        }

        /* Cardinal Compass Background */
        .compass-background {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            pointer-events: none;
            z-index: -3;
            opacity: 0.5;
        }

        .compass-background svg {
            width: 100%;
            height: 100%;
        }

        @media (max-width: 768px) {
            .compass-background {
                width: 400px;
                height: 400px;
            }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.4) 0%, transparent 40%),
                    radial-gradient(circle at 80% 50%, rgba(118, 75, 162, 0.4) 0%, transparent 40%),
                    radial-gradient(circle at 50% 50%, rgba(138, 92, 182, 0.3) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
            mix-blend-mode: screen;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow:
                    3px 3px 0 #667eea,
                    6px 6px 0 #764ba2,
                    9px 9px 0 rgba(0, 0, 0, 0.5),
                    9px 9px 10px rgba(0, 0, 0, 0.3);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 4px;
            transform: perspective(300px) rotateY(-5deg);
            display: inline-block;
            position: relative;
        }

        .header h1::after {
            content: ' █';
            position: absolute;
            right: -50px;
            top: 0;
            color: #00ff00;
            text-shadow:
                    0 0 5px #00ff00,
                    0 0 10px #00ff00,
                    0 0 15px #00ff00,
                    3px 3px 0 #667eea,
                    6px 6px 0 #764ba2;
            animation: blink 1s infinite;
            font-size: 3rem;
            transition: opacity 0.2s ease;
            opacity: 1;
        }

        .header h1.cursor-hidden::after {
            opacity: 0;
            animation: none;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow:
                    2px 2px 0 rgba(102, 126, 234, 0.5),
                    4px 4px 0 rgba(0, 0, 0, 0.3);
        }

        .link-card .hover-cursor {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #00ff00;
            font-size: 2rem;
            font-family: 'Courier New', monospace;
            text-shadow:
                    0 0 5px #00ff00,
                    0 0 10px #00ff00,
                    0 0 15px #00ff00,
                    2px 2px 0 #667eea;
            z-index: 10;
            pointer-events: none;
            display: none;
        }

        .link-card:hover .hover-cursor {
            display: block;
            animation: blink 1s infinite;
        }

        .link-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                    repeating-linear-gradient(
                            0deg,
                            transparent,
                            transparent 4px,
                            rgba(102, 126, 234, 0.05) 4px,
                            rgba(102, 126, 234, 0.05) 8px
                    ),
                    repeating-linear-gradient(
                            90deg,
                            transparent,
                            transparent 4px,
                            rgba(118, 75, 162, 0.05) 4px,
                            rgba(118, 75, 162, 0.05) 8px
                    );
            background-size: 8px 8px, 8px 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }

        .link-card:hover::after {
            opacity: 1;
            animation: scanlines 1s infinite linear;
        }

        .link-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .icon-wrapper::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                    repeating-linear-gradient(
                            0deg,
                            transparent,
                            transparent 4px,
                            rgba(255, 255, 255, 0.1) 4px,
                            rgba(255, 255, 255, 0.1) 8px
                    );
            pointer-events: none;
        }

        /* Enhanced Status Badge Styles */

        .status-badge:active {
            transform: scale(0.95);
        }

        /* Status Indicator Dot */

        .status-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        /* Status Text */
        .status-label {
            display: inline-block;
            line-height: 1;
        }

        /* Checking State */

        .status-badge.checking .status-dot {
            background: #ff9800;
            animation: spin-dot 1s linear infinite;
        }

            100% { transform: rotate(360deg); }
        }

        .status-badge.checking .status-label::after {
            content: '...';
            display: inline-block;
            width: 20px;
            text-align: left;
            animation: dots 1.5s steps(4, end) infinite;
        }

            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* Online State */

        .status-badge.online .status-dot {
            background: #4caf50;
            box-shadow: 0 0 0 1px rgba(76, 175, 80, 0.4);
        }

        .status-badge.online .status-dot::before {
            animation: ping-success 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping-success {
            75%, 100% {
                transform: translate(-50%, -50%) scale(2.5);
                opacity: 0;
            }
        }

        /* Offline State */

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .status-badge.offline .status-dot {
            background: #f44336;
            box-shadow: 0 0 0 1px rgba(244, 67, 54, 0.4);
            animation: pulse-error 2s ease-in-out infinite;
        }

        @keyframes pulse-error {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.95); opacity: 0.9; }
        }

        /* Response Time Display */
        .response-time {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-left: 4px;
            padding: 1px 4px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            cursor: help;
        }

        .status-badge.online .response-time {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
        }

        /* Icon for status */
        .status-icon {
            width: 14px;
            height: 14px;
            display: inline-block;
            margin-right: 2px;
        }

        .status-badge.online .status-icon svg {
            fill: #4caf50;
        }

        .status-badge.offline .status-icon svg {
            fill: #f44336;
        }

        .status-badge.checking .status-icon svg {
            fill: #ff9800;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 0;
            font-size: 0.85rem;
            margin-top: 10px;
            border: 2px solid #667eea;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 2px 2px 0 rgba(102, 126, 234, 0.3);
        }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            .links-grid {
                grid-template-columns: 1fr;
            }
            .ui-controls {
                right: 10px !important;
                top: 10px !important;
                max-width: calc(100vw - 20px) !important;
                gap: 8px !important;
            }
            .ui-toggle {
                padding: 8px 12px !important;
                font-size: 0.75rem !important;
                min-width: 100px !important;
            }
            .theme-selector {
                padding: 8px 12px !important;
                font-size: 0.75rem !important;
                min-width: 120px !important;
            }
        }

        @media (max-width: 480px) {
            .ui-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .ui-toggle, .theme-selector {
                width: 100%;
                text-align: center;
            }
        }
    </style>

    <style id="western-styles" disabled>
        /* Western Spaghetti Theme */
        body.western-mode {
            background: linear-gradient(180deg, #8B5A2B 0%, #D2691E 50%, #CD853F 100%);
            font-family: 'Playfair Display', 'Georgia', serif;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Desert background pattern */
        body.western-mode::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                    radial-gradient(circle at 20% 80%, transparent 50%, rgba(139, 69, 19, 0.3) 50.5%),
                    radial-gradient(circle at 80% 20%, transparent 45%, rgba(205, 133, 63, 0.3) 45.5%),
                    radial-gradient(circle at 40% 40%, transparent 52%, rgba(210, 105, 30, 0.2) 52.5%);
            background-size: 100px 100px, 150px 150px, 200px 200px;
            animation: tumbleWeed 30s linear infinite;
            pointer-events: none;
            z-index: -2;
        }

        @keyframes tumbleWeed {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }

        /* Hide modern UI elements */
        body.western-mode .container,
        body.western-mode .compass-background {
            display: none !important;
        }

        /* Western UI Container */
        .western-ui {
            display: none !important;
        }

        body.western-mode .western-ui {
            display: block !important;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Saloon-style header */
        .western-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            padding: 30px;
            background: linear-gradient(135deg, #654321 0%, #8B4513 100%);
            border: 8px solid #4A2C17;
            box-shadow:
                    inset 0 0 50px rgba(0,0,0,0.5),
                    0 10px 30px rgba(0,0,0,0.7);
            transform: perspective(800px) rotateX(2deg);
        }

        .western-header::before,
        .western-header::after {
            content: '★';
            position: absolute;
            top: 20px;
            font-size: 3rem;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: sheriffStar 2s ease-in-out infinite;
        }

        .western-header::before { left: 40px; }
        .western-header::after { right: 40px; animation-delay: 1s; }

        @keyframes sheriffStar {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }

        .western-title {
            font-size: 4rem;
            color: #FFD700;
            text-shadow:
                    3px 3px 0 #8B4513,
                    6px 6px 0 #654321,
                    9px 9px 15px rgba(0,0,0,0.8);
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-family: 'Rye', 'Georgia', serif;
            margin: 20px 0;
            animation: westernGlow 3s ease-in-out infinite;
        }

        @keyframes westernGlow {
            0%, 100% { text-shadow:
                    3px 3px 0 #8B4513,
                    6px 6px 0 #654321,
                    9px 9px 15px rgba(0,0,0,0.8),
                    0 0 30px rgba(255, 215, 0, 0.5); }
            50% { text-shadow:
                    3px 3px 0 #8B4513,
                    6px 6px 0 #654321,
                    9px 9px 15px rgba(0,0,0,0.8),
                    0 0 50px rgba(255, 215, 0, 0.8); }
        }

        .western-subtitle {
            color: #F5DEB3;
            font-size: 1.5rem;
            font-style: italic;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin-top: 10px;
        }

        /* Wanted poster style cards */
        .western-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        .wanted-poster {
            background: #F4E4C1;
            border: 3px solid #8B4513;
            padding: 20px;
            position: relative;
            transform: rotate(-1deg);
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
            box-shadow:
                    5px 5px 15px rgba(0,0,0,0.5),
                    inset 0 0 30px rgba(139, 69, 19, 0.1);
        }

        .wanted-poster:nth-child(even) {
            transform: rotate(1deg);
        }

        .wanted-poster:hover {
            transform: rotate(0deg) scale(1.05);
            box-shadow:
                    8px 8px 25px rgba(0,0,0,0.7),
                    inset 0 0 30px rgba(139, 69, 19, 0.2);
            z-index: 10;
        }

        .wanted-poster::before {
            content: 'WANTED';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #8B0000;
            color: #FFD700;
            padding: 5px 20px;
            font-weight: bold;
            font-size: 1.2rem;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            font-family: 'Rye', serif;
        }

        .poster-content {
            text-align: center;
            padding: 20px 10px;
        }

        .poster-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: #8B4513;
            border-radius: 50%;
            border: 4px solid #654321;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        .poster-icon svg {
            width: 50px;
            height: 50px;
            fill: #FFD700;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .poster-title {
            font-size: 1.8rem;
            color: #8B4513;
            font-weight: bold;
            margin-bottom: 10px;
            font-family: 'Rye', serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 rgba(139, 69, 19, 0.2);
        }

        .poster-description {
            color: #654321;
            font-size: 1rem;
            line-height: 1.5;
            margin: 15px 0;
            font-style: italic;
        }

        .poster-reward {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #8B4513;
            font-size: 1.2rem;
            color: #8B0000;
            font-weight: bold;
        }

        .poster-url {
            color: #654321;
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0.8;
            word-break: break-all;
        }

        /* Western status indicator */
        .western-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid #654321;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 5;
        }

        .western-status.online {
            background: #90EE90;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .western-status.online::after {
            content: '✓';
            color: #228B22;
        }

        .western-status.offline {
            background: #FFB6C1;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .western-status.offline::after {
            content: '✗';
            color: #8B0000;
        }

        .western-status.checking {
            background: #FFFFE0;
            animation: westernSpin 1s linear infinite;
        }

        .western-status.checking::after {
            content: '?';
            color: #DAA520;
        }

        @keyframes westernSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Decorative elements */
        .cactus-decoration {
            position: fixed;
            bottom: 20px;
            left: 30px;
            width: 100px;
            height: 150px;
            opacity: 0.3;
            z-index: -1;
            font-size: 8rem;
            color: #2F4F2F;
            transform: scaleX(-1);
        }

        .horseshoe {
            position: fixed;
            top: 100px;
            right: 50px;
            font-size: 4rem;
            color: #8B4513;
            opacity: 0.2;
            transform: rotate(15deg);
            z-index: -1;
        }

        /* Footer saloon doors */
        .saloon-footer {
            margin-top: 60px;
            padding: 20px;
            background: linear-gradient(180deg, #654321 0%, #8B4513 100%);
            border: 4px solid #4A2C17;
            text-align: center;
            color: #F5DEB3;
            font-size: 1.1rem;
            position: relative;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .saloon-footer::before,
        .saloon-footer::after {
            content: '';
            position: absolute;
            top: -30px;
            width: 80px;
            height: 30px;
            background: #654321;
            border: 3px solid #4A2C17;
            border-bottom: none;
        }

        .saloon-footer::before { left: 30%; }
        .saloon-footer::after { right: 30%; }

        /* Western mode UI controls */
        body.western-mode .ui-toggle {
            background: #8B4513 !important;
            color: #FFD700 !important;
            border: 3px solid #4A2C17 !important;
            font-family: 'Arial', sans-serif !important;
            letter-spacing: 1px !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;
            box-shadow:
                    4px 4px 0 rgba(0,0,0,0.5),
                    8px 8px 15px rgba(0,0,0,0.3) !important;
        }

        body.western-mode .ui-toggle:hover {
            transform: translate(-2px, -2px) rotate(-2deg) !important;
            box-shadow:
                    6px 6px 0 rgba(0,0,0,0.5),
                    10px 10px 20px rgba(0,0,0,0.4) !important;
        }

        /* Loading screen for Western mode */
        body.western-mode .loading-screen {
            background: linear-gradient(180deg, #8B5A2B 0%, #D2691E 100%);
        }

        body.western-mode 

        /* Responsive design */
        @media (max-width: 768px) {
            .western-title {
                font-size: 2.5rem;
            }
            .western-links-grid {
                grid-template-columns: 1fr;
            }
            .western-header::before,
            .western-header::after {
                display: none;
            }
        }
    </style>

    <style id="carnival-styles" disabled>
        /* Carnival/Six Flags Theme */
        body.carnival-mode {
            background: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF, #06FFB4, #FFD60A);
            background-size: 400% 400%;
            animation: carnivalGradient 15s ease infinite;
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes carnivalGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Confetti animation */
        body.carnival-mode::before {
            content: '🎊 🎈 🎪 🎨 🎭 🎢 🎡 🎠 🍿 🍭 🎯 🎪';
            position: fixed;
            top: -100px;
            left: 0;
            width: 100%;
            font-size: 2rem;
            animation: confettiFall 10s linear infinite;
            z-index: 0;
            opacity: 0.7;
        }

        @keyframes confettiFall {
            from { transform: translateY(0) rotate(0deg); }
            to { transform: translateY(120vh) rotate(720deg); }
        }

        /* Hide other UI elements */
        body.carnival-mode .container,
        body.carnival-mode .compass-background,
        body.carnival-mode .terminal-ui,
        body.carnival-mode .western-ui {
            display: none !important;
        }

        /* Carnival UI Container */
        .carnival-ui {
            display: none !important;
        }

        body.carnival-mode .carnival-ui {
            display: block !important;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Carnival Header */
        .carnival-header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #FFD60A, #FF006E);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .carnival-header::before,
        .carnival-header::after {
            content: '🎪';
            position: absolute;
            font-size: 4rem;
            animation: bounce 2s ease-in-out infinite;
        }

        .carnival-header::before { left: 30px; top: 20px; }
        .carnival-header::after { right: 30px; top: 20px; animation-delay: 1s; }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.2); }
        }

        .carnival-title {
            font-size: 4rem;
            background: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF, #06FFB4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 20px 0;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes textPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .carnival-subtitle {
            font-size: 1.5rem;
            color: #FFFFFF;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        /* Carnival Links Grid */
        .carnival-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 0 20px;
            margin-bottom: 40px;
        }

        .carnival-card {
            background: linear-gradient(135deg, #FFFFFF, #F0F0F0);
            border: 5px solid;
            border-image: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF, #06FFB4) 1;
            border-radius: 20px;
            padding: 25px;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .carnival-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
            transparent,
            rgba(255,255,255,0.3),
            transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }

        .carnival-card:hover::before {
            animation: shimmer 0.5s ease;
            opacity: 1;
        }

        @keyframes shimmer {
            from { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            to { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .carnival-card:hover {
            transform: translateY(-10px) rotate(-2deg);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .carnival-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #FF006E, #8338EC);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carnival-icon svg {
            width: 35px;
            height: 35px;
            fill: white;
        }

        .carnival-card h2 {
            color: #8338EC;
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .carnival-card .description {
            color: #333;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .carnival-card .url {
            color: #3A86FF;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .carnival-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD60A, #FF006E);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-top: 10px;
            text-transform: uppercase;
        }

        .carnival-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .carnival-status.online {
            background: #06FFB4;
            box-shadow: 0 0 10px #06FFB4;
        }

        .carnival-status.offline {
            background: #FF006E;
            box-shadow: 0 0 10px #FF006E;
        }

        .carnival-status.checking {
            background: #FFD60A;
            box-shadow: 0 0 10px #FFD60A;
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
        }

        /* Carnival Footer */
        .carnival-footer {
            background: linear-gradient(135deg, #8338EC, #3A86FF);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .carnival-footer p {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        /* Carnival mode UI controls */
        body.carnival-mode .ui-toggle {
            background: linear-gradient(135deg, #FF006E, #8338EC) !important;
            color: white !important;
            border: 3px solid #FFD60A !important;
            font-family: 'Comic Sans MS', sans-serif !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3) !important;
            animation: buttonFloat 3s ease-in-out infinite !important;
        }

        @keyframes buttonFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        body.carnival-mode .ui-toggle:hover {
            transform: scale(1.1) rotate(5deg) !important;
        }

        /* Carnival mode theme selector */
        .carnival-mode .theme-selector {
            background: linear-gradient(135deg, #FFD60A, #FF006E) !important;
            color: white !important;
            border: 3px solid #8338EC !important;
            font-family: 'Comic Sans MS', sans-serif !important;
            font-weight: bold !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3) !important;
            background-image: none !important;
            padding-left: 12px !important;
            text-transform: none !important;
        }

        .carnival-mode .theme-selector option {
            background: #8338EC !important;
            color: white !important;
            font-family: 'Comic Sans MS', sans-serif !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .carnival-title {
                font-size: 2.5rem;
            }
            .carnival-links-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <style id="terminal-styles" disabled>
        /* Hide modern UI completely when in terminal mode */
        body.terminal-mode 

        body.terminal-mode .compass-background {
            display: none !important;
            visibility: hidden !important;
        }

        body.terminal-mode {
            background-color: #000084 !important;
            padding: 20px !important;
            font-family: 'DOS', monospace !important;
            min-height: 100vh !important;
            background-image:
                    repeating-linear-gradient(
                            0deg,
                            transparent,
                            transparent 2px,
                            rgba(0, 0, 0, 0.1) 2px,
                            rgba(0, 0, 0, 0.1) 4px
                    ) !important;
        }

        body.terminal-mode::before,
        body.terminal-mode::after {
            display: none !important;
        }

        /* Terminal UI Styles */
        .terminal-ui {
            display: none !important;
        }

        .terminal-mode .terminal-ui {
            display: block !important;
        }

        .terminal-mode .loading-screen {
            display: none !important;
        }

        .tui-window {
            margin-bottom: 20px;
            background-color: #c0c0c0;
            border: none !important;
        }

        .tui-window fieldset.tui-fieldset {
            margin: 0;
            padding: 0;
            border: 6px double #ffffff;
            box-sizing: border-box;
            height: 100%;
            width: 100%;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-window {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-window fieldset.tui-fieldset {
            padding: 20px;
        }

        .title-text {
            font-size: 2.5rem;
            font-weight: bold;
            color: #000084;
            text-shadow: 2px 2px 0px #ffffff;
            letter-spacing: 4px;
            margin: 20px 0;
            animation: blink 2s step-start infinite;
        }

        .subtitle {
            color: #000000;
            font-size: 1rem;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .links-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .link-window {
            transition: transform 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
        }

        .link-window:hover {
            transform: translate(-2px, -2px);
        }

        .link-window .tui-window {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .link-content {
            padding: 15px;
            padding-bottom: 5px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .icon-ascii {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #000084;
            font-weight: bold;
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .link-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #000000;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .link-description {
            color: #404040;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 10px;
            flex-grow: 1;
        }

        .link-url {
            color: #000084;
            font-size: 0.8rem;
            word-break: break-all;
            border-top: 1px dotted #808080;
            padding-top: 10px;
            margin-top: auto;
        }

        /* Enhanced Terminal Mode Status */
        .terminal-status {
            display: inline-block;
            margin-left: 10px;
            padding: 3px 8px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 2px solid;
            position: relative;
        }

        .terminal-status::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }

        .terminal-status.checking {
            background: #333300;
            color: #ffff00;
            border-color: #ffff00;
            animation: terminal-blink 1s steps(2, start) infinite;
        }

        .terminal-status.checking::before {
            background: #ffff00;
            animation: terminal-pulse 1s infinite;
        }

        .terminal-status.online {
            background: #003300;
            color: #00ff00;
            border-color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }

        .terminal-status.online::before {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .terminal-status.offline {
            background: #330000;
            color: #ff0000;
            border-color: #ff0000;
            text-shadow: 0 0 5px #ff0000;
        }

        .terminal-status.offline::before {
            background: #ff0000;
            box-shadow: 0 0 5px #ff0000;
        }

        @keyframes terminal-blink {
            50% { opacity: 0.5; }
        }

        @keyframes terminal-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); }
        }

        .badge-container {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .tui-statusbar {
            background-color: #000084;
            color: #ffffff;
            margin-top: 10px;
        }

        /* ASCII Art Background */
        .ascii-decoration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            color: rgba(0, 0, 132, 0.05);
            z-index: -1;
            font-weight: bold;
            letter-spacing: 20px;
            pointer-events: none;
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Terminal cursor effect */
        .cursor::after {
            content: '_';
            animation: cursor-blink 1s step-start infinite;
            font-weight: bold;
            color: #00ff00;
        }

        @keyframes cursor-blink {
            50% { opacity: 0; }
        }

        /* DOS-style navigation bar */
        .nav-bar {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 2px;
            margin-bottom: 20px;
        }

        .nav-item {
            display: inline-block;
            padding: 5px 15px;
            margin: 2px;
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            cursor: pointer;
            text-decoration: none;
            color: #000000;
            font-weight: bold;
        }

        .nav-item:hover {
            background-color: #000084;
            color: #ffffff;
        }

        .nav-item:active {
            border-color: #808080 #ffffff #ffffff #808080;
        }
    </style>

    <style>
        /* UI Controls Container */
        .ui-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 500px;
        }

        /* Theme Selector Dropdown */
        .theme-selector {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 16px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: none;
            letter-spacing: 0.5px;
            font-size: 0.82rem;
            cursor: pointer;
            box-shadow:
                    3px 3px 0 rgba(0, 0, 0, 0.3),
                    6px 6px 0 rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
            border-radius: 0;
            min-width: 140px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 20px;
            padding-right: 35px;
            text-align: left;
            text-indent: 0;
        }

        .theme-selector:hover {
            transform: translate(-2px, -2px);
            box-shadow:
                    6px 6px 0 rgba(0, 0, 0, 0.3),
                    12px 12px 0 rgba(102, 126, 234, 0.2);
        }

        .theme-selector:focus {
            outline: 2px solid #00ff00;
            outline-offset: 2px;
        }

        .theme-selector option {
            background: #333;
            color: white;
            padding: 10px;
        }

        /* Terminal mode theme selector */
        .terminal-mode .theme-selector {
            background: #c0c0c0 !important;
            color: #000000 !important;
            border: 2px solid !important;
            border-color: #ffffff #808080 #808080 #ffffff !important;
            box-shadow: none !important;
            background-image: none !important;
            padding-left: 12px !important;
            font-family: 'Courier New', monospace !important;
            text-transform: none !important;
        }

        .terminal-mode .theme-selector:hover {
            background-color: #000084 !important;
            color: #ffffff !important;
            transform: none !important;
        }

        /* Remove any decorations from terminal mode select */
        .terminal-mode .theme-selector option {
            background: #c0c0c0 !important;
            color: #000000 !important;
            font-family: 'Courier New', monospace !important;
            text-transform: none !important;
        }

        .terminal-mode .theme-selector::before,
        .terminal-mode .theme-selector::after,
        .terminal-mode .theme-selector option::before,
        .terminal-mode .theme-selector option::after {
            content: none !important;
            display: none !important;
        }

        /* Western mode theme selector - simplified to avoid rendering issues */
        .western-mode .theme-selector {
            background: #8B4513 !important;
            color: #FFD700 !important;
            border: 3px solid #4A2C17 !important;
            font-family: 'Arial', sans-serif !important;
            font-weight: bold !important;
            box-shadow:
                    4px 4px 0 rgba(0,0,0,0.5),
                    8px 8px 15px rgba(0,0,0,0.3) !important;
            text-indent: 0 !important;
            line-height: normal !important;
            padding-left: 12px !important;
            background-image: none !important;
        }

        /* Remove any decorations from select and options */
        .western-mode .theme-selector,
        .western-mode .theme-selector:focus,
        .western-mode .theme-selector option {
            text-decoration: none !important;
            font-family: 'Arial', sans-serif !important;
            text-transform: none !important;
        }

        .western-mode .theme-selector option {
            background: #8B4513 !important;
            color: #FFD700 !important;
            padding: 5px !important;
        }

        /* Ensure no pseudo-elements */
        .western-mode .theme-selector::before,
        .western-mode .theme-selector::after,
        .western-mode .theme-selector option::before,
        .western-mode .theme-selector option::after {
            content: none !important;
            display: none !important;
        }

        .western-mode .theme-selector:hover {
            transform: translate(-2px, -2px) rotate(-2deg) !important;
        }

        /* UI Toggle Button */
        .ui-toggle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 16px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.82rem;
            cursor: pointer;
            box-shadow:
                    3px 3px 0 rgba(0, 0, 0, 0.3),
                    6px 6px 0 rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
            white-space: nowrap;
            border-radius: 0;
            min-width: 120px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .ui-toggle:hover {
            transform: translate(-2px, -2px);
            box-shadow:
                    6px 6px 0 rgba(0, 0, 0, 0.3),
                    12px 12px 0 rgba(102, 126, 234, 0.2);
        }

        .ui-toggle:active {
            transform: translate(0, 0);
            box-shadow:
                    2px 2px 0 rgba(0, 0, 0, 0.3),
                    4px 4px 0 rgba(102, 126, 234, 0.2);
        }

        .terminal-mode .ui-toggle {
            background: #c0c0c0 !important;
            color: #000000 !important;
            border: 2px solid !important;
            border-color: #ffffff #808080 #808080 #ffffff !important;
            box-shadow: none !important;
            position: relative !important;
        }

        .terminal-mode .ui-toggle:hover {
            background-color: #000084 !important;
            color: #ffffff !important;
            transform: none !important;
        }

        .terminal-mode .ui-toggle:active {
            border-color: #808080 #ffffff #ffffff #808080 !important;
        }

        /* Error message styling */
        .error-message {
            background-color: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            color: #ff0000;
            padding: 20px;
            margin: 20px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        /* Ensure proper hiding of UIs */
        body:not(.terminal-mode) .terminal-ui {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        body:not(.western-mode) .western-ui {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        body:not(.carnival-mode) .carnival-ui {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        body.terminal-mode .container,
        body.terminal-mode .compass-background,
        body.terminal-mode .western-ui,
        body.terminal-mode .carnival-ui {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        body.western-mode .terminal-ui,
        body.western-mode .carnival-ui,
        body.western-mode 

        body.carnival-mode .terminal-ui,
        body.carnival-mode .western-ui,
        body.carnival-mode 

        /* Critical: Override pseudo-elements when themes are not active */
        /* This needs to be in the main styles to always apply */
        body:not(.western-mode)::before,
        body:not(.western-mode)::after {
            content: '' !important;
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        body:not(.carnival-mode)::before,
        body:not(.carnival-mode)::after {
            content: '' !important;
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        /* Hide theme-specific header decorations when not in their respective modes */
        body:not(.western-mode) .western-header::before,
        body:not(.western-mode) .western-header::after,
        body:not(.carnival-mode) .carnival-header::before,
        body:not(.carnival-mode) .carnival-header::after {
            content: '' !important;
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }
    </style>
</head>
<body>
<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Loading NStarX Portal...</p>
    </div>
</div>

<!-- UI Controls -->
<div class="ui-controls">
    <select class="theme-selector" id="themeSelector" onchange="switchTheme(this.value)" title="Select theme">
        <option value="modern">Modern</option>
        <option value="terminal">Terminal</option>
        <option value="western">Western</option>
        <option value="carnival">Carnival</option>
    </select>
    <button class="ui-toggle ping-console-btn" onclick="togglePingConsole()" title="Show/Hide ping console" style="
            background: linear-gradient(135deg, #2196f3, #1976d2);
        ">
        📟 Console
    </button>
    <button class="ui-toggle refresh-btn" onclick="refreshAllStatuses()" title="Refresh all status indicators" style="
            background: linear-gradient(135deg, #4caf50, #45a049);
        ">
        🔄 Refresh
    </button>
</div>

<!-- Ping Console -->
<div id="pingConsole" style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: min(500px, calc(100vw - 40px));
        max-height: 300px;
        background: #000;
        color: #0f0;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        border: 2px solid #0f0;
        border-radius: 4px;
        padding: 10px;
        overflow-y: auto;
        z-index: 9998;
        display: none;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    ">
    <div style="border-bottom: 1px solid #0f0; padding-bottom: 5px; margin-bottom: 10px;">
        <strong>📟 PING CONSOLE v1.0</strong>
        <button onclick="clearPingConsole()" style="
                float: right;
                background: transparent;
                color: #0f0;
                border: 1px solid #0f0;
                padding: 2px 8px;
                cursor: pointer;
                font-size: 10px;
            ">CLEAR</button>
    </div>
    <div id="pingOutput" style="white-space: pre-wrap; line-height: 1.4;"></div>
</div>

<!-- Modern UI -->
<div class="container">
    <div class="header">
        <h1 id="portalTitle">NStarX Portal</h1>
        <p id="portalSubtitle">Quick access to all NStarX resources and documentation</p>
    </div>

    <div class="links-grid" id="modernLinksGrid">
        <!-- Links will be dynamically inserted here -->
    </div>
</div>

<!-- Cardinal Compass Background -->
<div class="compass-background">
    <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
        <!-- Outer Circle -->
        <circle cx="300" cy="300" r="280" fill="none" stroke="#667eea" stroke-width="3" opacity="0.8"/>
        <circle cx="300" cy="300" r="250" fill="none" stroke="#764ba2" stroke-width="2" opacity="0.6"/>
        <circle cx="300" cy="300" r="220" fill="none" stroke="#667eea" stroke-width="2" opacity="0.4"/>

        <!-- Cardinal Lines -->
        <!-- North-South -->
        <line x1="300" y1="50" x2="300" y2="550" stroke="#667eea" stroke-width="4" opacity="0.9"/>
        <!-- East-West -->
        <line x1="50" y1="300" x2="550" y2="300" stroke="#667eea" stroke-width="4" opacity="0.9"/>

        <!-- Diagonal Lines -->
        <line x1="100" y1="100" x2="500" y2="500" stroke="#764ba2" stroke-width="2" opacity="0.5"/>
        <line x1="500" y1="100" x2="100" y2="500" stroke="#764ba2" stroke-width="2" opacity="0.5"/>

        <!-- Cardinal Points -->
        <!-- North -->
        <g transform="translate(300, 50)">
            <polygon points="0,-20 -15,15 0,5 15,15" fill="#667eea" opacity="1"/>
            <text x="0" y="-30" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">N</text>
        </g>

        <!-- South -->
        <g transform="translate(300, 550)">
            <polygon points="0,20 -15,-15 0,-5 15,-15" fill="#667eea" opacity="0.8"/>
            <text x="0" y="40" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">S</text>
        </g>

        <!-- East -->
        <g transform="translate(550, 300)">
            <polygon points="20,0 -15,-15 -5,0 -15,15" fill="#667eea" opacity="0.8"/>
            <text x="35" y="7" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">E</text>
        </g>

        <!-- West -->
        <g transform="translate(50, 300)">
            <polygon points="-20,0 15,-15 5,0 15,15" fill="#667eea" opacity="0.8"/>
            <text x="-35" y="7" text-anchor="middle" font-family="Courier New, monospace" font-size="32" font-weight="bold" fill="#667eea" opacity="1">W</text>
        </g>

        <!-- Center Star (North Star) -->
        <g transform="translate(300, 300)">
            <!-- Outer star glow -->
            <circle cx="0" cy="0" r="40" fill="url(#starGradient)" opacity="0.6"/>
            <!-- Star shape -->
            <path d="M 0,-25 L 6,-8 L 25,-4 L 9,9 L 12,25 L 0,15 L -12,25 L -9,9 L -25,-4 L -6,-8 Z"
                  fill="#00ff00" opacity="1" stroke="#00ff00" stroke-width="2" filter="url(#glow)"/>
            <!-- Inner star -->
            <circle cx="0" cy="0" r="8" fill="#00ff00" opacity="1"/>
        </g>

        <!-- Gradient Definition -->
        <defs>
            <radialGradient id="starGradient">
                <stop offset="0%" stop-color="#00ff00" stop-opacity="1"/>
                <stop offset="50%" stop-color="#667eea" stop-opacity="0.6"/>
                <stop offset="100%" stop-color="#764ba2" stop-opacity="0"/>
            </radialGradient>

            <!-- Glow filter for star -->
            <filter id="glow">
                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            </filter>

            <!-- Subtle grid pattern -->
            <pattern id="gridPattern" x="0" y="0" width="50" height="50" patternUnits="userSpaceOnUse">
                <line x1="0" y1="0" x2="0" y2="50" stroke="#667eea" stroke-width="1" opacity="0.3"/>
                <line x1="0" y1="0" x2="50" y2="0" stroke="#667eea" stroke-width="1" opacity="0.3"/>
            </pattern>
        </defs>

        <!-- Background grid -->
        <rect x="0" y="0" width="600" height="600" fill="url(#gridPattern)"/>

        <!-- Decorative compass marks -->
        <g transform="translate(300, 300)">
            <!-- 30 degree marks -->
            <g opacity="0.5">
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(30)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(60)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(120)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(150)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(210)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(240)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(300)"/>
                <line x1="0" y1="-180" x2="0" y2="-200" stroke="#667eea" stroke-width="2" transform="rotate(330)"/>
            </g>
        </g>
    </svg>
</div>

<!-- Western UI (Hidden by default) -->
<div class="western-ui">
    <!-- Decorative elements -->
    <div class="cactus-decoration">🌵</div>
    <div class="horseshoe">🧲</div>

    <!-- Western Header -->
    <div class="western-header">
        <h1 class="western-title" id="westernTitle">NSTARX SALOON</h1>
        <p class="western-subtitle" id="westernSubtitle">The Wildest Links in the Digital Frontier</p>
    </div>

    <!-- Western Links Grid -->
    <div class="western-links-grid" id="westernLinksGrid">
        <!-- Western links will be dynamically inserted here -->
    </div>

    <!-- Saloon Footer -->
    <div class="saloon-footer">
        <p>🎯 High Noon at the Digital Corral 🎯</p>
        <p style="font-size: 0.9rem; opacity: 0.8;">Est. 2024 | Where Code Meets the Wild West</p>
    </div>
</div>

<!-- Terminal UI (Hidden by default) -->
<div class="terminal-ui">
    <!-- ASCII Art Background -->
    <div class="ascii-decoration">★</div>

    <div class="main-container">
        <!-- Navigation Bar -->
        <div class="nav-bar" id="terminalNavBar">
            <!-- Navigation items will be dynamically inserted here -->
        </div>

        <!-- Header Window -->
        <div class="tui-window red-168 header-window">
            <fieldset class="tui-fieldset">
                <legend class="center">═══ NSTARX PORTAL ═══</legend>
                <div class="title-text"><span id="terminalTitle">NSTARX</span><span class="cursor"></span></div>
                <div class="subtitle" id="terminalSubtitle">▓▒░ QUICK ACCESS TO ALL RESOURCES ░▒▓</div>
                <div class="tui-divider"></div>
                <p style="margin: 10px 0;" id="terminalWelcome">Welcome to the NStarX Portal Terminal Interface</p>
                <p style="margin: 10px 0; color: #404040;" id="terminalStatus">System Ready. Select a destination below.</p>
            </fieldset>
        </div>

        <!-- Links Grid -->
        <div class="links-container" id="terminalLinksContainer">
            <!-- Terminal links will be dynamically inserted here -->
        </div>

        <!-- Footer Status Bar -->
        <div class="tui-window" style="margin-top: 40px;">
            <div class="tui-statusbar">
                <ul id="footerStatusBar">
                    <li>F1=Help</li>
                    <li>F5=Refresh</li>
                    <li>ESC=Exit</li>
                    <li id="clock">--:--:--</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Carnival/Six Flags UI -->
<div class="carnival-ui">
    <!-- Carnival Header -->
    <div class="carnival-header">
        <h1 class="carnival-title" id="carnivalTitle">NSTARX CARNIVAL</h1>
        <p class="carnival-subtitle" id="carnivalSubtitle">🎢 Welcome to the Most Exciting Links in the Digital Midway! 🎡</p>
    </div>

    <!-- Carnival Links Grid -->
    <div class="carnival-links-grid" id="carnivalLinksGrid">
        <!-- Carnival links will be dynamically inserted here -->
    </div>

    <!-- Carnival Footer -->
    <div class="carnival-footer">
        <p>🎪 Step Right Up to the Digital Carnival! 🎪</p>
        <p style="font-size: 1rem; opacity: 0.9;">🎠 Fun Never Stops at NStarX Park! 🎢</p>
    </div>
</div>

<script>
    // Global variables
    // Embedded portal data to avoid CORS issues
    let portalData = {
      "portal": {
        "title": "Adrian",
        "subtitle": "Quick access to all local services",
        "terminalTitle": "ADRIAN",
        "terminalSubtitle": "▓▒░ LOCAL NETWORK SERVICES ░▒▓",
        "terminalWelcome": "Welcome to Adrian's Local Services Portal",
        "terminalStatus": "System Ready. Select a destination below.",
        "version": "1.0"
      },
      "links": [
        {
          "id": "promox-big",
          "title": "Proxmox Big",
          "shortTitle": "Proxmox Big",
          "description": "Main Proxmox virtualization server for hosting VMs and containers",
          "url": "https://192.168.2.17:8006/",
          "displayUrl": "192.168.2.17:8006",
          "badge": "Server",
          "terminalBadge": ["SERVER", "ONLINE"],
          "icon": "🖥️",
          "svgPath": "M3,12V6.5L9,5.5L15,6.5V11.5L9,10.5L3,12M3,13L9,14.5L15,13V17L9,18L3,17V13M10,5.5V6.5L9,6.5L8,6.5V5.5L9,5.5H10M15,7.5L9,8.5L3,7.5V8.5L9,9.5L15,8.5V7.5M9,15.5L3,14.5V15.5L9,16.5L15,15.5V14.5L9,15.5M21,11.5V17L15,18V13L21,11.5M21,10.5L15,12V6.5L21,5.5V10.5Z",
          "colorClass": "green-168",
          "terminalLegend": "[ PROXMOX ]",
          "enabled": true
        },
        {
          "id": "pfsense",
          "title": "pfSense",
          "shortTitle": "pfSense",
          "description": "Network firewall and router management interface",
          "url": "https://192.168.2.1/",
          "displayUrl": "192.168.2.1",
          "badge": "Firewall",
          "terminalBadge": ["FIREWALL", "ACTIVE"],
          "icon": "🔒",
          "svgPath": "M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,5A3,3 0 0,1 15,8A3,3 0 0,1 12,11A3,3 0 0,1 9,8A3,3 0 0,1 12,5M17.13,17C15.92,18.85 14.11,20.24 12,20.92C9.89,20.24 8.08,18.85 6.87,17C6.53,16.5 6.24,16 6,15.47C6,13.82 8.71,12.47 12,12.47C15.29,12.47 18,13.79 18,15.47C17.76,16 17.47,16.5 17.13,17Z",
          "colorClass": "orange-168",
          "terminalLegend": "[ FIREWALL ]",
          "enabled": true
        },
        {
          "id": "pihole",
          "title": "Pi-hole",
          "shortTitle": "Pi-hole",
          "description": "Network-wide ad blocker and DNS server management",
          "url": "https://192.168.0.53/admin",
          "displayUrl": "192.168.0.53/admin",
          "badge": "DNS",
          "terminalBadge": ["DNS", "BLOCKING"],
          "icon": "🛡️",
          "svgPath": "M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M13,17V18H7V17H13M17,14V15H7V14H17Z",
          "colorClass": "cyan-168",
          "terminalLegend": "[ DNS FILTER ]",
          "enabled": true
        },
        {
          "id": "promox-small",
          "title": "Proxmox Small",
          "shortTitle": "Proxmox Small",
          "description": "Secondary Proxmox server for additional VMs and testing",
          "url": "https://192.168.2.11:8006",
          "displayUrl": "192.168.2.11:8006",
          "badge": "Server",
          "terminalBadge": ["SERVER", "ONLINE"],
          "icon": "💾",
          "svgPath": "M3,12V6.5L9,5.5L15,6.5V11.5L9,10.5L3,12M3,13L9,14.5L15,13V17L9,18L3,17V13M10,5.5V6.5L9,6.5L8,6.5V5.5L9,5.5H10M15,7.5L9,8.5L3,7.5V8.5L9,9.5L15,8.5V7.5M9,15.5L3,14.5V15.5L9,16.5L15,15.5V14.5L9,15.5M21,11.5V17L15,18V13L21,11.5M21,10.5L15,12V6.5L21,5.5V10.5Z",
          "colorClass": "yellow-168",
          "terminalLegend": "[ PROXMOX ]",
          "enabled": true
        },
        {
          "id": "my-cardinal",
          "title": "My Cardinal - Key Lessons",
          "shortTitle": "Key Lessons",
          "description": "Essential wisdom and life lessons for meaningful living",
          "url": "https://padrian2s.github.io/mycardinal/",
          "displayUrl": "padrian2s.github.io/mycardinal",
          "badge": "Wisdom",
          "terminalBadge": ["WISDOM", "LESSONS"],
          "icon": "📖",
          "svgPath": "M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M13,17V18H7V17H13M17,14V15H7V14H17Z",
          "colorClass": "cyan-168",
          "terminalLegend": "[ WISDOM ]",
          "enabled": true
        }
      ],
      "navigation": {
        "terminal": [
          {
            "label": "ABOUT",
            "action": "showAbout"
          },
          {
            "label": "REFRESH",
            "action": "refreshPage"
          },
          {
            "label": "HELP",
            "action": "showHelp"
          }
        ],
        "shortcuts": [
          {
            "key": "F1",
            "action": "showHelp",
            "label": "Help"
          },
          {
            "key": "F5",
            "action": "refreshPage",
            "label": "Refresh"
          },
          {
            "key": "Escape",
            "action": "exitPortal",
            "label": "Exit"
          }
        ]
      },
      "config": {
        "enableLocalStorage": true,
        "defaultMode": "modern",
        "animations": {
          "compass": true,
          "typing": true,
          "ascii": true
        },
        "cache": {
          "enabled": false,
          "duration": 3600
        }
      }
    };

    let isTerminalMode = false;
    let isWesternMode = false;
    let isCarnivalMode = false;

    // Load JSON data (now just initializes with embedded data)
    async function loadPortalData() {
        try {
            // Data is already embedded, just initialize
            initializePortal();
        } catch (error) {
            console.error('Error initializing portal:', error);
            showError('Failed to initialize portal. Please refresh the page.');
        }
    }

    // Show error message
    function showError(message) {
        const loadingScreen = document.getElementById('loadingScreen');
        loadingScreen.innerHTML = `
                <div class="error-message">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
    }

    // Initialize portal with loaded data
    function initializePortal() {
        if (!portalData) return;

        // Set portal titles and subtitles
        document.getElementById('portalTitle').textContent = portalData.portal.title;
        document.getElementById('portalSubtitle').textContent = portalData.portal.subtitle;
        document.getElementById('terminalTitle').textContent = portalData.portal.terminalTitle;
        document.getElementById('terminalSubtitle').textContent = portalData.portal.terminalSubtitle;
        document.getElementById('terminalWelcome').textContent = portalData.portal.terminalWelcome;
        document.getElementById('terminalStatus').textContent = portalData.portal.terminalStatus;

        // Generate modern UI links
        generateModernLinks();

        // Generate terminal UI links
        generateTerminalLinks();

        // Generate terminal navigation
        generateTerminalNav();

        // Generate western UI links
        generateWesternLinks();

        // Generate carnival UI links
        generateCarnivalLinks();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();

        // Hide loading screen
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
        }, 500);

        // Initialize UI features
        initializeUIFeatures();

        // Load saved UI preference
        loadUIPreference();

        // Start status monitoring after initialization
        startStatusMonitoring();
    }

    // Generate modern UI links
    function generateModernLinks() {
        const grid = document.getElementById('modernLinksGrid');
        grid.innerHTML = '';

        portalData.links.filter(link => link.enabled).forEach((link, index) => {
            const uniqueLinkId = `link-${index}`; // Always use index for unique ID
            const linkCard = document.createElement('a');
            linkCard.href = link.url;
            linkCard.className = 'link-card';
            linkCard.target = '_blank';
            linkCard.setAttribute('data-link-id', uniqueLinkId);
            linkCard.setAttribute('data-url', link.url);
            linkCard.innerHTML = `
                    <div class="status-badge checking" id="status-${uniqueLinkId}"
                         onclick="event.preventDefault(); event.stopPropagation(); updateLinkStatus('${uniqueLinkId}', '${link.url}'); return false;"
                         title="Click to refresh status">
                        <span class="status-dot"></span>
                        <span class="status-label">Checking</span>
                    </div>
                    <span class="hover-cursor">█</span>
                    <div class="icon-wrapper">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="${link.svgPath}"/>
                        </svg>
                    </div>
                    <h2>${link.title}</h2>
                    <p class="description">${link.description}</p>
                    <p class="url">${link.displayUrl}</p>
                    <span class="badge">${link.badge}</span>
                `;
            grid.appendChild(linkCard);
        });

        // Start status checking after a short delay to ensure DOM is ready
        setTimeout(() => {
            checkAllStatuses();
        }, 100);
    }

    // Generate terminal UI links
    function generateTerminalLinks() {
        const container = document.getElementById('terminalLinksContainer');
        container.innerHTML = '';

        portalData.links.filter(link => link.enabled).forEach((link, index) => {
            const uniqueLinkId = `link-${index}`; // Always use index for unique ID
            const linkWindow = document.createElement('a');
            linkWindow.href = link.url;
            linkWindow.className = 'link-window';
            linkWindow.target = '_blank';
            linkWindow.setAttribute('data-link-id', uniqueLinkId);
            linkWindow.setAttribute('data-url', link.url);

            linkWindow.innerHTML = `
                    <div class="tui-window ${link.colorClass}">
                        <fieldset class="tui-fieldset">
                            <legend>${link.terminalLegend} <span class="terminal-status checking" id="terminal-status-${uniqueLinkId}">WAIT</span></legend>
                            <div class="link-content">
                                <span class="icon-ascii">${link.icon}</span>
                                <div class="link-title">${link.shortTitle}</div>
                                <div class="link-description">${link.description}</div>
                                <div class="link-url">» ${link.displayUrl}</div>
                            </div>
                        </fieldset>
                    </div>
                `;
            container.appendChild(linkWindow);
        });

        // Start status checking if in terminal mode
        if (isTerminalMode) {
            setTimeout(() => {
                checkAllStatuses();
            }, 100);
        }
    }

    // Generate western UI links
    function generateWesternLinks() {
        const grid = document.getElementById('westernLinksGrid');
        if (!grid) return;
        grid.innerHTML = '';

        portalData.links.filter(link => link.enabled).forEach((link, index) => {
            const uniqueLinkId = `link-${index}`;
            const poster = document.createElement('a');
            poster.href = link.url;
            poster.className = 'wanted-poster';
            poster.target = '_blank';
            poster.setAttribute('data-link-id', uniqueLinkId);
            poster.setAttribute('data-url', link.url);

            poster.innerHTML = `
                    <div class="western-status checking" id="western-status-${uniqueLinkId}"></div>
                    <div class="poster-content">
                        <div class="poster-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="${link.svgPath}"/>
                            </svg>
                        </div>
                        <h2 class="poster-title">${link.shortTitle || link.title}</h2>
                        <p class="poster-description">${link.description}</p>
                        <div class="poster-reward">REWARD: ${link.badge}</div>
                        <p class="poster-url">Trail: ${link.displayUrl}</p>
                    </div>
                `;
            grid.appendChild(poster);
        });

        // Start status checking if in western mode
        if (isWesternMode) {
            setTimeout(() => {
                checkAllStatuses();
            }, 100);
        }
    }

    // Generate carnival UI links
    function generateCarnivalLinks() {
        const grid = document.getElementById('carnivalLinksGrid');
        if (!grid) return;
        grid.innerHTML = '';

        portalData.links.filter(link => link.enabled).forEach((link, index) => {
            const uniqueLinkId = `link-${index}`;
            const card = document.createElement('a');
            card.href = link.url;
            card.className = 'carnival-card';
            card.target = '_blank';
            card.setAttribute('data-link-id', uniqueLinkId);
            card.setAttribute('data-url', link.url);

            card.innerHTML = `
                    <div class="carnival-status checking" id="carnival-status-${uniqueLinkId}"></div>
                    <div class="carnival-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="${link.svgPath}"/>
                        </svg>
                    </div>
                    <h2>${link.shortTitle || link.title}</h2>
                    <p class="description">${link.description}</p>
                    <p class="url">${link.displayUrl}</p>
                    <span class="carnival-badge">${link.badge}</span>
                `;
            grid.appendChild(card);
        });

        // Start status checking if in carnival mode
        if (isCarnivalMode) {
            setTimeout(() => {
                checkAllStatuses();
            }, 100);
        }
    }

    // Generate terminal navigation bar
    function generateTerminalNav() {
        const navBar = document.getElementById('terminalNavBar');
        navBar.innerHTML = '';

        portalData.navigation.terminal.forEach(item => {
            const navItem = document.createElement('a');
            navItem.href = '#';
            navItem.className = 'nav-item';
            navItem.textContent = item.label;
            navItem.onclick = (e) => {
                e.preventDefault();
                window[item.action]();
                return false;
            };
            navBar.appendChild(navItem);
        });
    }

    // Setup keyboard shortcuts
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', function(e) {
            if (isTerminalMode) {
                const shortcut = portalData.navigation.shortcuts.find(s => s.key === e.key);
                if (shortcut) {
                    e.preventDefault();
                    window[shortcut.action]();
                }
            }
        });
    }

    // Unified Theme Switching Function
    function switchTheme(theme) {
        const body = document.body;
        const terminalStyles = document.getElementById('terminal-styles');
        const westernStyles = document.getElementById('western-styles');
        const carnivalStyles = document.getElementById('carnival-styles');
        const tuicssLink = document.getElementById('tuicss-stylesheet');
        const themeSelector = document.getElementById('themeSelector');

        // Reset all theme classes and styles first
        body.classList.remove('terminal-mode', 'western-mode', 'carnival-mode');
        terminalStyles.disabled = true;
        westernStyles.disabled = true;
        carnivalStyles.disabled = true;
        tuicssLink.disabled = true;
        isTerminalMode = false;
        isWesternMode = false;
        isCarnivalMode = false;

        // Remove any theme-specific header classes
        const header = document.querySelector('.header');
        if (header) {
            header.classList.remove('western-header', 'carnival-header', 'terminal-header');
        }

        // Remove any theme-specific container classes
        const container = document.querySelector('.container');
        if (container) {
            container.classList.remove('western-container', 'carnival-container', 'terminal-container');
        }

        // Clear any terminal intervals
        if (window.clockInterval) {
            clearInterval(window.clockInterval);
            window.clockInterval = null;
        }
        if (window.asciiInterval) {
            clearInterval(window.asciiInterval);
            window.asciiInterval = null;
        }

        // Apply the selected theme
        switch (theme) {
            case 'terminal':
                body.classList.add('terminal-mode');
                terminalStyles.disabled = false;
                tuicssLink.disabled = false;
                isTerminalMode = true;
                // Initialize terminal UI features
                initTerminalUI();
                break;

            case 'western':
                body.classList.add('western-mode');
                westernStyles.disabled = false;
                isWesternMode = true;
                break;

            case 'carnival':
                body.classList.add('carnival-mode');
                carnivalStyles.disabled = false;
                isCarnivalMode = true;
                break;

            case 'modern':
            default:
                // Modern theme is the default, no additional styles needed
                break;
        }

        // Update the selector to match current theme
        themeSelector.value = theme;

        // Re-check statuses for the new theme
        checkAllStatuses();

        // Save preference to localStorage
        if (portalData?.config?.enableLocalStorage) {
            localStorage.setItem('uiMode', theme);
        }
    }

    // Load saved UI preference
    function loadUIPreference() {
        if (portalData?.config?.enableLocalStorage) {
            const savedMode = localStorage.getItem('uiMode');
            if (savedMode && ['modern', 'terminal', 'western', 'carnival'].includes(savedMode)) {
                switchTheme(savedMode);
            }
        }
    }

    // Backwards compatibility - redirect old toggle functions
    function toggleUI() {
        switchTheme(isTerminalMode ? 'modern' : 'terminal');
    }

    function toggleWestern() {
        switchTheme(isWesternMode ? 'modern' : 'western');
    }

    // Terminal UI Functions
    function initTerminalUI() {
        // Clock functionality for terminal mode
        if (!window.clockInterval) {
            function updateClock() {
                const clockElement = document.getElementById('clock');
                if (clockElement) {
                    const now = new Date();
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');
                    clockElement.textContent = `${hours}:${minutes}:${seconds}`;
                }
            }
            window.clockInterval = setInterval(updateClock, 1000);
            updateClock();
        }

        // Terminal typing effect for title
        if (portalData?.config?.animations?.typing) {
            const titleElement = document.querySelector('.terminal-ui .title-text');
            if (titleElement && !titleElement.hasAttribute('data-typed')) {
                titleElement.setAttribute('data-typed', 'true');
                const originalText = portalData.portal.terminalTitle;
                titleElement.innerHTML = '';
                let index = 0;

                function typeText() {
                    if (index < originalText.length) {
                        titleElement.innerHTML = originalText.slice(0, index + 1);
                        index++;
                        setTimeout(typeText, 100);
                    } else {
                        titleElement.innerHTML = originalText + '<span class="cursor"></span>';
                    }
                }

                setTimeout(typeText, 500);
            }
        }

        // ASCII art animation
        if (portalData?.config?.animations?.ascii && !window.asciiInterval) {
            const asciiChars = ['★', '◆', '■', '▲', '●', '✦', '◉', '◈'];
            let currentChar = 0;

            window.asciiInterval = setInterval(() => {
                const decoration = document.querySelector('.terminal-ui .ascii-decoration');
                if (decoration) {
                    decoration.textContent = asciiChars[currentChar];
                    currentChar = (currentChar + 1) % asciiChars.length;
                }
            }, 3000);
        }
    }

    // Initialize UI features
    function initializeUIFeatures() {
        // Modern UI animations
        if (portalData?.config?.animations?.compass) {
            const compass = document.querySelector('.compass-background svg');
            if (compass) {
                compass.style.transition = 'transform 2s ease-out';
                setTimeout(() => {
                    compass.style.transform = 'rotate(360deg)';
                }, 100);
                setTimeout(() => {
                    compass.style.transition = '';
                    compass.style.transform = '';
                }, 2100);
            }
        }

        // Add cursor movement on hover for modern UI
        const headerTitle = document.querySelector('.header h1');
        let hoveredCards = 0;

        document.querySelectorAll('.link-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                hoveredCards++;

                // Hide title cursor when hovering a card
                if (headerTitle) {
                    headerTitle.classList.add('cursor-hidden');
                }

                // Add subtle pulse to compass when hovering cards
                const compass = document.querySelector('.compass-background');
                if (compass) {
                    compass.style.transition = 'opacity 0.3s ease';
                    compass.style.opacity = '0.7';
                }
            });

            card.addEventListener('mouseleave', () => {
                hoveredCards--;

                // Show title cursor when not hovering any card
                if (hoveredCards === 0 && headerTitle) {
                    headerTitle.classList.remove('cursor-hidden');
                }

                // Reset compass opacity
                const compass = document.querySelector('.compass-background');
                if (compass) {
                    compass.style.opacity = '0.5';
                }
            });
        });
    }

    // Terminal mode helper functions
    function showAbout() {
        alert(`NStarX Portal v${portalData?.portal?.version || '1.0'}\n\nTerminal Interface for NStarX Resources\n\n© 2024 NStarX Corporation\nAll Rights Reserved`);
    }

    function showHelp() {
        alert('NAVIGATION HELP\n\n• Click on any window to open the link\n• Use F1 for help\n• Use F5 to refresh\n• Press ESC to exit\n\nKEYBOARD SHORTCUTS:\n• Tab - Navigate between links\n• Enter - Open selected link\n• Alt+← - Go back');
    }

    function refreshPage() {
        location.reload();
    }

    function exitPortal() {
        if (confirm('Exit portal?')) {
            window.close();
        }
    }

    // Status checking functionality
    const statusCache = new Map();
    let statusCheckInterval = null;

    // Ping Console Functions
    function togglePingConsole() {
        const console = document.getElementById('pingConsole');
        console.style.display = console.style.display === 'none' ? 'block' : 'none';
    }

    function clearPingConsole() {
        document.getElementById('pingOutput').innerHTML = '';
    }

    function pingLog(message, type = 'info') {
        const output = document.getElementById('pingOutput');
        const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
        let color = '#0f0';
        let prefix = '';

        switch(type) {
            case 'success':
                color = '#0f0';
                prefix = '✓';
                break;
            case 'error':
                color = '#f00';
                prefix = '✗';
                break;
            case 'warning':
                color = '#ff0';
                prefix = '⚠';
                break;
            case 'ping':
                color = '#0ff';
                prefix = '🔍';
                break;
            default:
                color = '#fff';
                prefix = '•';
        }

        const line = `<span style="color: #888">[${timestamp}]</span> <span style="color: ${color}">${prefix} ${message}</span>\n`;
        output.innerHTML += line;
        output.scrollTop = output.scrollHeight;
    }

    // Ping-style URL status checker with multiple detection methods
    async function checkUrlStatus(url) {
        console.log(`🔍 Pinging: ${url}`);
        pingLog(`PING ${url}`, 'ping');

        // Handle mixed content - use CORS proxy for HTTP resources from HTTPS
        if (url.startsWith('http://') && window.location.protocol === 'https:') {
            console.warn(`⚠️ ${url} - HTTP resource from HTTPS context`);
            pingLog(`  Mixed content detected, using proxy check`, 'warning');

            // Use a CORS proxy to check the actual status
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 5000);

                // Try using a public CORS proxy
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;

                pingLog(`  Checking via CORS proxy...`, 'info');
                const response = await fetch(proxyUrl, {
                    method: 'HEAD',
                    signal: controller.signal,
                    cache: 'no-store'
                });

                clearTimeout(timeout);

                if (response.ok) {
                    pingLog(`  Result: ONLINE (verified via proxy)`, 'success');
                    return 'online';
                } else {
                    pingLog(`  Result: OFFLINE (HTTP ${response.status})`, 'error');
                    return 'offline';
                }
            } catch (error) {
                // If proxy check fails, try alternative method
                console.log(`  Proxy check failed: ${error.message}`);

                // For Azure resources, they're likely offline if we can't reach them
                if (url.includes('cloudapp.azure.com')) {
                    const hostname = new URL(url).hostname;
                    pingLog(`  ping: cannot resolve ${hostname}: Unknown host`, 'error');
                    pingLog(`  Result: OFFLINE (unreachable)`, 'error');
                    return 'offline';
                }

                pingLog(`  Result: UNKNOWN (check failed)`, 'warning');
                return 'unknown';
            }
        }

        // Try multiple ping methods in sequence
        const pingMethods = [
            { name: 'Performance Ping', fn: performancePing },
            { name: 'Fetch Ping', fn: fetchPing },
            { name: 'Image Beacon', fn: imageBeaconPing },
            { name: 'Script Tag', fn: scriptTagPing }
        ];

        for (const method of pingMethods) {
            try {
                console.log(`  Trying ${method.name}...`);
                pingLog(`  Trying ${method.name}...`, 'info');
                const startTime = performance.now();
                const result = await method.fn(url);
                const elapsed = Math.round(performance.now() - startTime);

                if (result !== 'unknown') {
                    console.log(`  ✓ ${method.name} result: ${result}`);
                    if (result === 'online') {
                        pingLog(`  ✓ ${method.name}: ONLINE (${elapsed}ms)`, 'success');
                    } else {
                        pingLog(`  ✗ ${method.name}: OFFLINE`, 'error');
                    }
                    return result;
                }
            } catch (error) {
                console.log(`  ✗ ${method.name} failed:`, error.message);
                pingLog(`  ✗ ${method.name} failed: ${error.message}`, 'error');
            }
        }

        // If all methods fail, make an educated guess based on URL pattern
        const guess = guessStatusByPattern(url);
        pingLog(`  Final result: ${guess.toUpperCase()} (pattern-based)`, guess === 'online' ? 'warning' : 'error');
        return guess;
    }

    // Method 1: Use Performance API to measure actual network timing
    async function performancePing(url) {
        return new Promise((resolve) => {
            // This method works best for resources we can actually load
            const testUrl = new URL(url);
            const pingUrl = `${testUrl.origin}/favicon.ico?ping=${Date.now()}`;

            // Clear any existing entries
            if (performance.clearResourceTimings) {
                performance.clearResourceTimings();
            }

            const img = new Image();
            const startMark = `ping-start-${Date.now()}`;
            const timeout = setTimeout(() => {
                resolve('unknown');
            }, 2000);

            performance.mark(startMark);

            img.onload = img.onerror = () => {
                clearTimeout(timeout);
                const entries = performance.getEntriesByName(pingUrl);
                if (entries.length > 0) {
                    const entry = entries[0];
                    // If we got timing data, server responded
                    if (entry.responseEnd > 0) {
                        resolve('online');
                    } else {
                        resolve('offline');
                    }
                } else {
                    // No performance entry means blocked or failed
                    resolve('offline');
                }
            };

            img.src = pingUrl;
        });
    }

    // Method 2: Fetch with controlled timeout
    async function fetchPing(url) {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 3000);

        try {
            const startTime = Date.now();
            const response = await fetch(url, {
                method: 'HEAD',
                mode: 'no-cors',
                signal: controller.signal,
                cache: 'no-store',
                redirect: 'follow'
            });
            clearTimeout(timeout);
            const endTime = Date.now();

            // In no-cors mode, we can't read the response but
            // if fetch completes without error, server is reachable
            console.log(`    Fetch completed in ${endTime - startTime}ms`);
            return 'online';
        } catch (error) {
            clearTimeout(timeout);
            if (error.name === 'AbortError') {
                return 'offline'; // Timeout
            }
            // Network error
            return 'offline';
        }
    }

    // Method 3: Image beacon with better error handling
    async function imageBeaconPing(url) {
        return new Promise((resolve) => {
            const testUrl = new URL(url);
            const img = new Image();
            let resolved = false;

            const timeout = setTimeout(() => {
                if (!resolved) {
                    resolved = true;
                    img.src = '';
                    resolve('offline');
                }
            }, 3000);

            img.onload = () => {
                if (!resolved) {
                    resolved = true;
                    clearTimeout(timeout);
                    resolve('online');
                }
            };

            img.onerror = () => {
                if (!resolved) {
                    resolved = true;
                    clearTimeout(timeout);
                    resolve('offline');
                }
            };

            // Try multiple image paths
            const imagePaths = [
                '/favicon.ico',
                '/favicon.png',
                '/apple-touch-icon.png',
                '/robots.txt' // Some servers return images for any 404
            ];

            img.src = `${testUrl.origin}${imagePaths[0]}?_=${Date.now()}`;
        });
    }

    // Method 4: Script tag injection (works for some CORS-blocked sites)
    async function scriptTagPing(url) {
        return new Promise((resolve) => {
            const script = document.createElement('script');
            const timeout = setTimeout(() => {
                document.head.removeChild(script);
                resolve('unknown');
            }, 2000);

            script.onload = () => {
                clearTimeout(timeout);
                document.head.removeChild(script);
                resolve('online');
            };

            script.onerror = () => {
                clearTimeout(timeout);
                document.head.removeChild(script);
                resolve('offline');
            };

            // Try to load a small JS file (many sites have this)
            const testUrl = new URL(url);
            script.src = `${testUrl.origin}/robots.txt?callback=_&_=${Date.now()}`;
            script.async = true;
            document.head.appendChild(script);
        });
    }

    // Fallback: Make educated guess based on URL pattern
    function guessStatusByPattern(url) {
        console.log(`  ⚠️ All ping methods failed, guessing based on pattern`);

        // Known reliable domains
        if (url.includes('github.io')) {
            // GitHub Pages are usually reliable
            return 'online';
        }

        if (url.includes('ondigitalocean.app')) {
            // DigitalOcean apps are usually up
            return 'online';
        }

        if (url.includes('cloudapp.azure.com')) {
            // Azure apps might be behind firewall or down
            // Conservative approach
            return 'offline';
        }

        // Default to offline if we can't determine
        return 'offline';
    }

    async function updateLinkStatus(linkId, url) {
        try {
            // Update modern UI status
            const statusBadge = document.getElementById(`status-${linkId}`);
            const terminalStatus = document.getElementById(`terminal-status-${linkId}`);
            const westernStatus = document.getElementById(`western-status-${linkId}`);

            // Verify elements exist
            if (!statusBadge && !terminalStatus && !westernStatus) {
                console.warn(`Status elements not found for linkId: ${linkId}`);
                return;
            }

            // Set to checking state
            if (statusBadge) {
                statusBadge.className = 'status-badge checking';
                statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">Checking</span>
                    `;
            }
            if (terminalStatus) {
                terminalStatus.className = 'terminal-status checking';
                terminalStatus.textContent = 'PING';
            }
            if (westernStatus) {
                westernStatus.className = 'western-status checking';
            }

            // Simulate response time
            const startTime = Date.now();

            // Check the actual status
            const status = await checkUrlStatus(url);
            const responseTime = Date.now() - startTime;
            statusCache.set(url, { status, timestamp: Date.now(), responseTime });

            // Update UI based on status with smooth transition
            if (statusBadge) {
                // Add transition effect
                statusBadge.style.transform = 'scale(0.95)';
                statusBadge.style.opacity = '0.8';

                setTimeout(() => {
                    statusBadge.className = `status-badge ${status}`;
                    let statusText = status === 'online' ? 'Online' : 'Offline';
                    let statusNote = '';

                    // Check if this is an HTTP resource viewed from HTTPS
                    if (url && url.startsWith('http://') && window.location.protocol === 'https:' && status === 'online') {
                        statusNote = ' (assumed)';
                        statusBadge.setAttribute('title', 'Status assumed - HTTP resource cannot be checked from HTTPS page\nClick the link to verify');
                    } else {
                        const lastChecked = new Date().toLocaleTimeString();
                        statusBadge.setAttribute('title', `Last checked: ${lastChecked}\nClick to refresh`);
                    }

                    const responseTimeText = responseTime < 500 ? 'Fast' : responseTime < 1000 ? 'Good' : 'Slow';
                    statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">${statusText}${statusNote}</span>
                        ${status === 'online' && responseTime && !statusNote ? `<span class="response-time" title="${responseTime}ms">${responseTimeText}</span>` : ''}
                    `;

                    // Restore scale
                    setTimeout(() => {
                        statusBadge.style.transform = '';
                        statusBadge.style.opacity = '';
                    }, 50);
                }, 100);
            }
            if (terminalStatus) {
                terminalStatus.className = `terminal-status ${status}`;
                if (status === 'online') {
                    terminalStatus.textContent = `UP:${responseTime}ms`;
                } else {
                    terminalStatus.textContent = 'DOWN';
                }
            }
            if (westernStatus) {
                westernStatus.className = `western-status ${status}`;
            }
        } catch (error) {
            console.error(`Error updating status for ${linkId}:`, error);
            // Set to offline on error
            const statusBadge = document.getElementById(`status-${linkId}`);
            const terminalStatus = document.getElementById(`terminal-status-${linkId}`);
            const westernStatus = document.getElementById(`western-status-${linkId}`);

            if (statusBadge) {
                statusBadge.className = 'status-badge offline';
                statusBadge.innerHTML = `
                        <span class="status-dot"></span>
                        <span class="status-label">Error</span>
                    `;
            }
            if (terminalStatus) {
                terminalStatus.className = 'terminal-status offline';
                terminalStatus.textContent = 'ERR';
            }
            if (westernStatus) {
                westernStatus.className = 'western-status offline';
            }
        }
    }

    async function checkAllStatuses() {
        if (!portalData || !portalData.links) return;

        const uniqueUrls = new Map();
        portalData.links.filter(link => link.enabled).forEach((link, index) => {
            const linkId = `link-${index}`; // Always use index for consistent unique ID
            if (!uniqueUrls.has(link.url)) {
                uniqueUrls.set(link.url, []);
            }
            uniqueUrls.get(link.url).push(linkId);
        });

        // Check each unique URL
        for (const [url, linkIds] of uniqueUrls) {
            // Check cache first
            const cached = statusCache.get(url);
            const cacheAge = cached ? Date.now() - cached.timestamp : Infinity;

            if (cacheAge < 30000) { // Use cache if less than 30 seconds old
                linkIds.forEach(linkId => {
                    const statusBadge = document.getElementById(`status-${linkId}`);
                    const terminalStatus = document.getElementById(`terminal-status-${linkId}`);
                    const westernStatus = document.getElementById(`western-status-${linkId}`);

                    if (statusBadge) {
                        statusBadge.className = `status-badge ${cached.status}`;
                        const statusText = cached.status === 'online' ? 'Online' : 'Offline';
                        const responseTimeText = cached.responseTime && cached.responseTime < 500 ? 'Fast' : cached.responseTime < 1000 ? 'Good' : 'Slow';
                        const lastChecked = new Date(cached.timestamp).toLocaleTimeString();
                        statusBadge.setAttribute('title', `Last checked: ${lastChecked}\nClick to refresh`);
                        statusBadge.setAttribute('onclick', `event.preventDefault(); event.stopPropagation(); updateLinkStatus('${linkId}', '${url}'); return false;`);
                        statusBadge.innerHTML = `
                                <span class="status-dot"></span>
                                <span class="status-label">${statusText}</span>
                                ${cached.status === 'online' && cached.responseTime ? `<span class="response-time" title="${cached.responseTime}ms">${responseTimeText}</span>` : ''}
                            `;
                    }
                    if (terminalStatus) {
                        terminalStatus.className = `terminal-status ${cached.status}`;
                        if (cached.status === 'online' && cached.responseTime) {
                            terminalStatus.textContent = `UP:${cached.responseTime}ms`;
                        } else {
                            terminalStatus.textContent = 'DOWN';
                        }
                    }
                    if (westernStatus) {
                        westernStatus.className = `western-status ${cached.status}`;
                    }
                });
            } else {
                // Check status for all link IDs with this URL
                // Use Promise.all to update all statuses concurrently
                Promise.all(linkIds.map(linkId => updateLinkStatus(linkId, url)));
            }
        }
    }

    // Auto-refresh status every 60 seconds
    function startStatusMonitoring() {
        if (statusCheckInterval) {
            clearInterval(statusCheckInterval);
        }
        statusCheckInterval = setInterval(() => {
            checkAllStatuses();
        }, 60000);
    }

    // Manual refresh all statuses
    function refreshAllStatuses() {
        // Clear cache to force fresh check
        statusCache.clear();

        // Visual feedback
        const refreshBtn = event?.target;
        if (refreshBtn) {
            const originalText = refreshBtn.textContent;
            refreshBtn.textContent = '⏳ Refreshing...';
            refreshBtn.disabled = true;

            setTimeout(() => {
                refreshBtn.textContent = originalText;
                refreshBtn.disabled = false;
            }, 2000);
        }

        // Check all statuses
        checkAllStatuses();
    }

    // Stop monitoring when page is hidden
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
        } else {
            checkAllStatuses();
            startStatusMonitoring();
        }
    });

    // Load portal data on page load
    window.addEventListener('DOMContentLoaded', () => {
        loadPortalData();
        // Note: startStatusMonitoring is now called from initializePortal after data loads
    });
</script>
    <!-- Common JavaScript -->
    <script src="assets/js/common.js"></script>
</body>
</html>
